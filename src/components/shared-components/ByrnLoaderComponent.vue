<template>
  <div
    class="modal loader"
    :class="{ 'hidden': !isModalVisible }"
    :style="{ 'display': isModalHidden ? 'none' : 'flex'}"
    ref="modalLoader">
    <div class="wrapper px-4">
      <svg id="byrn-loader" width="512" height="512" version="1.1" viewBox="0 0 512 512"
        xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#"
        xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
        <path fill="#2e6f3e" stroke-width="2.8"
          d="m418.93 436.37c-18.534-18.368-32.158-30.609-34.065-30.609-1.7481 0-8.6906 4.1468-15.428 9.215-32.378 24.358-77.28 38.774-120.73 38.762-23.581-6e-3 -43.576-3.3137-66.379-10.98-31.805-10.692-55.063-25.922-81.154-53.142-26.42-27.563-40.85-53.49-50.667-91.037-5.6304-21.534-7.1446-60.074-3.241-82.49 9.2398-53.059 37.779-99.329 81.266-131.75 41.714-31.103 101.51-45.488 153.18-36.848 44.274 7.4032 77.575 24.357 110.51 56.263 40.88 39.603 61.456 88.37 61.456 145.66 0 46.646-13.794 87.895-41.549 124.24-3.5384 4.6341-6.4334 9.7835-6.4334 11.443 0 1.6985 13.38 16.519 30.609 33.904 26.006 26.242 30.609 31.631 30.609 35.837 0 6.2384-6.0196 12.145-12.377 12.145-3.9049 0-10.043-5.2766-35.605-30.609zm-135.23-10.042c38.655-6.3346 81.849-32.407 105.96-63.957 30.568-40.004 43.332-82.475 38.961-129.64-8.0376-86.75-77.837-156.05-163.89-162.71-42.952-3.327-79.432 5.9963-114.57 29.28-35.033 23.216-59.038 54.803-72.155 94.942-6.4637 19.78-8.3995 33.025-8.3045 56.822 0.32152 80.505 53.322 149.7 131.75 172 26.389 7.5049 50.529 8.4628 82.254 3.264zm-174.73-67.998c-3.1009-3.1009 0.5892-3.8606 18.752-3.8606 16.546 0 19.855 0.41364 19.855 2.4818 0 2.0601-3.1866 2.4818-18.752 2.4818-10.313 0-19.248-0.49637-19.855-1.103zm48.14-60.529-0.43377-61.632-24.818-0.28048c-21.148-0.239-24.898-0.66723-25.353-2.8955-0.48437-2.3677 13.09-2.615 143.53-2.615 136.1 0 144.07 0.16 144.07 2.8955 4.6e-4 2.7202-4.373 2.8683-72.27 2.4472-44.196-0.27415-72.882 0.16381-73.846 1.1273-0.99772 0.99772 11.096 19.619 32.974 50.773 55.379 78.859 50.821 71.812 46.446 71.812-2.9693 0-6.8214-4.3651-17.886-20.268-12.548-18.035-45.936-65.697-63.457-90.587-3.5233-5.005-7.5366-10.031-8.9186-11.168-2.9351-2.416-9.5386-2.7461-10.899-0.5448-0.83418 1.3498 7.696 20.069 40.021 87.823 9.4246 19.754 15.325 32.867 15.325 34.056 0 0.37956-1.3584 0.6901-3.0186 0.6901-2.0928 0-4.4761-3.1714-7.771-10.341-4.3732-9.5158-12.215-26.15-31.783-67.423-4.0988-8.6451-10.387-22.03-13.974-29.744-3.5867-7.7144-7.4083-14.59-8.4923-15.279-3.3463-2.1276-9.4704-1.4343-10.476 1.186-0.79786 2.0792 10.221 40.615 30.183 105.56 4.7408 15.423 4.783 16.054 1.0723 16.02-2.3729-0.022-6.1525-10.995-20.943-60.805-9.9262-33.428-18.861-61.325-19.855-61.994-2.5152-1.692-10.524-1.5704-11.603 0.17607-0.49026 0.79328 0.53949 10.286 2.2884 21.096 1.7488 10.809 4.3284 27.843 5.7323 37.853 1.4039 10.01 4.0495 28.252 5.8792 40.537 1.8297 12.285 3.3301 22.523 3.3343 22.75 5e-3 0.2275-1.348 0.41364-3.0048 0.41364-2.4708 0-3.3367-2.157-4.8156-11.996-0.99171-6.5976-4.971-33.588-8.8429-59.978-3.8719-26.39-7.784-48.951-8.6936-50.135-0.90957-1.184-3.9508-1.9285-6.7584-1.6546l-5.1046 0.49814-0.43378 61.632c-0.4232 60.13-0.51348 61.632-3.7026 61.632-3.1891 0-3.2794-1.5025-3.7026-61.632zm183.45 59.151c-0.8212-2.14 2.5654-2.4818 24.589-2.4818 22.024 0 25.411 0.34181 24.589 2.4818-0.78505 2.0458-5.105 2.4818-24.589 2.4818s-23.804-0.43602-24.589-2.4818zm-234.35-41.364c0-2.0737 3.401-2.4818 20.682-2.4818 17.281 0 20.682 0.40812 20.682 2.4818 0 2.0737-3.401 2.4818-20.682 2.4818-17.281 0-20.682-0.40814-20.682-2.4818zm206.27 1.3788c-3.3042-3.3042 2.4988-3.8606 40.261-3.8606 35.665 0 41.364 0.34195 41.364 2.4818 0 2.1381-5.5765 2.4818-40.261 2.4818-22.144 0-40.757-0.49637-41.364-1.1031zm-206.27-36.125c0-2.0737 3.401-2.4818 20.682-2.4818 17.281 0 20.682 0.40813 20.682 2.4818 0 2.0737-3.401 2.4818-20.682 2.4818-17.281 0-20.682-0.40814-20.682-2.4818zm181.45 1.3788c-0.60669-0.60665-1.1031-1.7235-1.1031-2.4818 0-0.75834 24.198-1.3788 53.773-1.3788 46.695 0 53.773 0.32667 53.773 2.4818 0 2.1541-6.9553 2.4818-52.67 2.4818-28.969 0-53.167-0.49637-53.773-1.103zm-181.45-27.024c0-3.1326 1.103-3.3091 20.682-3.3091 19.579 0 20.682 0.17649 20.682 3.3091 0 3.1326-1.103 3.3091-20.682 3.3091-19.579 0-20.682-0.1765-20.682-3.3091zm164.13 1.3236c-1.092-1.092-1.9855-2.5811-1.9855-3.3091 0-0.72799 28.213-1.3236 62.696-1.3236 52.261 0 62.844 0.38615 63.587 2.3201 0.48967 1.276 0.44523 2.7651-0.0988 3.3091-0.54393 0.54399-28.264 0.98905-61.601 0.98905-44.937 0-61.126-0.51348-62.598-1.9855zm-152.77-35.183c-0.42257-0.42256-0.60341-4.4692-0.40188-8.9924 0.31285-7.0217-0.20104-8.596-3.5148-10.767-11.995-7.8596-7.4221-55.124 5.5108-56.956 7.5454-1.0687 11.907 6.7615 14.359 25.779 1.7911 13.892-0.44333 25.184-6.0127 30.386-4.0396 3.7736-4.7597 5.7227-4.7597 12.883 0 5.9272-0.65612 8.4363-2.2061 8.4363-1.2134 0-2.5518-0.34575-2.9744-0.76832zm8.0378-26.868c5.4056-8.2403 3.9838-37.826-2.0301-42.244-4.4679-3.2825-7.0727-1.0407-9.7093 8.356-3.2055 11.424-3.4908 24.823-0.66535 31.25 3.6972 8.41 8.0158 9.3282 12.405 2.6377zm220.13 26.704c-0.57544-0.57541-0.62879-2.1341-0.11863-3.4638 0.53817-1.4024-1.2111-4.5086-4.1661-7.3977-6.1502-6.013-7.8348-14.668-6.161-31.655 1.5397-15.625 5.9446-24.389 12.258-24.389 8.1897 0 12.751 9.1483 13.611 27.3 0.86809 18.323 0.11727 22.323-5.1854 27.625-3.0797 3.0798-4.8462 6.3869-4.55 8.5184 0.46908 3.3758-3.4111 5.7373-5.6871 3.4612zm8.1033-20.159c4.2055-10.065 0.30197-39.429-5.4938-41.326-3.6278-1.1878-7.575 15.391-6.9485 29.184 0.83569 18.402 7.2225 24.635 12.442 12.142zm27.023 17.836c0-1.9236-1.5718-5.6234-3.493-8.2219s-3.8638-8.0149-4.3171-12.037c-1.0146-9.0017 2.1801-25.221 5.6515-28.692 4.0165-4.0165 9.2672-2.242 12.497 4.2233 4.8667 9.7421 3.214 38.055-2.2213 38.055-0.7035 0-1.5147 2.0411-1.8026 4.5359-0.64567 5.5941-6.3145 7.5123-6.3145 2.1367zm6.56-14.837c3.2999-6.1658 0.66604-28.236-3.3696-28.236-3.8853 0-6.7244 21.305-3.8407 28.819 1.3781 3.5914 5.1389 3.2872 7.2103-0.58318z" />
      </svg>
      <div>
        <p class="text-center">Cargando...</p>
        <div class="progress px-3 px-md-1 px-lg-0">
          <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<style>
.modal {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  /* Styles for the content*/
  display: flex;
  justify-content: center;
  align-items: flex-start;
  z-index: 10000;
}

.no-overflow {
  overflow: hidden;
}

.loader {
  background: rgb(233, 248, 223);
  transition: opacity 300ms ease-in-out;
  opacity: 1;
}

.loader.hidden {
  opacity: 0;
}

.loader .wrapper {
  max-width: 400px;
}

svg#byrn-loader {
  animation-name: fading;
  animation-direction: alternate;
  animation-iteration-count: infinite;
  animation-duration: 850ms;
  animation-timing-function: ease-out;
  width: 100%;
}

@keyframes fading {
  from {
    opacity: 1;
  }

  to {
    opacity: 0.2;
  }
}
</style>

<script>
import { mapGetters } from 'vuex'
import { getters as mainGetters } from '@/store'
import { setTimeout } from 'timers'

export default {
  name: 'byrn-loader',
  data: () => ({
    isModalVisible: false,
    isModalHidden: true
  }),
  mounted () {
    window.addEventListener('transitionend', this.onModalTransitionEnd)
  },
  destroyed () {
    window.removeEventListener('transitionend', this.onModalTransitionEnd)
  },
  computed: {
    ...mapGetters({
      modalState: mainGetters.isModalHidden
    })
  },
  watch: {
    modalState (oldValue, newValue) {
      newValue ? this.onModalShow() : this.onModalHide()
    }
  },
  methods: {
    onModalHide () {
      this.isModalVisible = false
      window.document.body.classList.remove('no-overflow')
    },
    onModalShow () {
      this.isModalHidden = false
      this.isModalVisible = true
      window.document.body.classList.add('no-overflow')
    },
    onModalTransitionEnd (event) {
      const { target } = event
      if (target !== this.$refs.modalLoader || this.isModalVisible) { return }
      this.isModalHidden = true
    }
  }
}
</script>
